---
title: "Implicit Timecourse Project"
output:
  word_document:
    toc: yes
    toc_depth: 2
  html_document:
    df_print: paged
    toc: yes
    toc_depth: 2
    number_sections: yes
    theme: united
  pdf_document:
    toc: yes
    toc_depth: '2'
    number_sections: yes
---

# Pre-amble

In this project we set out to characterize the speed of implicit adaptation under various circumstances. There are 4 experiments.

  1. Size of rotation + washout
  2. Feedback that is supposed to increase explicit adaptation (cursor-jump, terminal)
  3. Delays, before or after terminal feedback (before should be more explicit)
  4. A comparison with the time-course of re-aiming responses

In all conditions, 4 reach training targets were used, and after each training trial (with feedback) a no-cursor trial was completed. For these trials, participants were instructed to just move their hand straight to the target, regardless of how the cursor moved. After a brief familiarization task, participants did a 20+20 reach trial baseline, and a 100+100 reach trial adaptation phase. In the first experiment, this was followed by a 24+24 trial washout phase. In most conditions, there were 8 re-aiming responses given before the 57th, 61st, 65th, 69th, 73rd, 77th, 81st and 85th reach training trial. Except for the very last condition, where every reach training trial was preceded by a re-aiming response. (These were given by orienting an arrow in the screen, with 1 degree precision.)

Using the no-cursor reach aftereffects after every reach training trial, we can map out the speed of implicit adaptation with high temporal precision. The conditions are all supposed to evoke larger explicit strategies (or just overall adaptation, in the first experiment with rotation sizes). The re-aiming responses assess the magnitude of this strategy in each participant, such that we can also see if increased explicit strategies go hand in hand with decreased implicit adaptation (or vice versa) or whether or not these two kinds of adaptation are largely indepedent. Except for the last condition, we can't (and don't need to) assess the speed of explicit adaptation.

## Setting up R session

This chunk might help solve some issues with `renv`:

```{r eval=F}
unloadNamespace('renv')
install.packages('renv', version="1.0.3")
loadNamespace('renv')

renv::activate()
```

You will want to restore the `renv` as used while doing this project:

```{r eval=F}
renv::restore()
```

Install the most recent Reach package:

```{r}
library('remotes')
ip <- installed.packages()
if ('Reach' %in% ip[,'Package']) {
  if (ip[which(ip[,'Package'] == 'Reach'),'Version'] < "2023.12.17") {
    remotes::install_github('thartbm/Reach')
  }
} else {
  remotes::install_github('thartbm/Reach')
}
```

The project was done with Reach version="2023.12.17" but I don't know how to do proper versioning yet.

We load all the code for this project:

```{r echo=F, results='hide', quietly=T, warn.conflicts=F}
source('R/data.R')
source('R/utilities.R')
source('R/figures.R')
source('R/statistics.R')
source('R/exponentials.R')
```

## Data

Before doing anything, we need to get the data on the local machine.

```{r eval=FALSE}
# download the raw data AND the processed data:
downloadData()
```

This downloads the relevant data from the associated [OSF repository](https://osf.io/ajwyr/).

## Processing

If we'd also want to redo all the processing, we could run the code in this cell:

```{r eval=FALSE}
# this summarizes each reach or re-aiming response to an angular deviation relative to the target
extractAngularDeviations()
```

For all reaches, this extracts the reach deviations at 0.2 times the home-target distance (i.e. 2 cm of a 10 cm reaching movement). And for aiming responses the aiming deviation from the target. The code to do so is provided, so if you think it should be done a different (and obviously better) way, the code can be changed / replaced.

You could even redo the bootstrapping of all the exponential fit parameters, even though it would take a long time. If you changed the way the dependent variables are calculated, this step can not be skipped though, as most of the statistics / conclusion depend on the bootstrapped exponential fits.

By default, this code uses 75% of available cores (the parallelization is meant to work on Linux and MacOS as well as on Windows) and does 5000 bootstraps for each fit. This could also be changed but it's not an easy, single function argument.

```{r eval=FALSE}
# these are sorted by how much time they take: most time at the top
bootstrapAllLearningExpFits()
bootstrapAllWashoutExpFits()
bootstrapAllAimingExpFits()
groupAvgFits()
```

The above three chunks of code have been set to not evaluate, but they can be run manually in the notebook.

# Experiment 1: rotation size

In the first part we gauge our method of interleaved no-cursor trials to see how this responds to 4 different rotation sizes (15, 30, 45, and 60 degree rotations). We don't find anything surprising. 

Here is a table about the sample of participants:

```{r}
knitr::kable(demographicsTable(exp=1))
```


Here is the plot of the data.

```{r fig.width=6, fig.height=9}
expBehaviorFig(exp=1, target='inline', timecoursemode = 'absolute')
```

## Table of behavioral descriptors

The table below lists group average estimates as well as bootstrapped 95% confidence intervals for several descriptors of behavior. The first 4 columns show parameters of exponential fits, for training reaches as well as no-cursor reaches. The first value is the optimal parameter for the average of the group data, the two values or the 2.5% and 97.5% value over 5k bootstraps. Then there are the re-aiming responses, which are simple the average and the upper and lower limit of a bootstrapped 95% confidence interval (1k values). The last two columns show exponential fits on the washout data, similar to the first 4 columns, but for simplicity we only show the starting points (here "asymptotes", need to re-label this in the paper) as the rates of changes are all very high (> 90%) and don't show any effects.

```{r}
knitr::kable(expTable(exp=1))
```

## First impression of figure and table

First, we confirm that with rotations smaller than 30 degrees, implicit reach aftereffects develop slower, while at all other rotation sizes, the rate of change is comparable, but only if expressed in real degrees change per trial, rather than percentage of asymptote. This casts some doubt on the use of rates/proportion to express speed of learning. Here we plot the exponential fits in real degrees, rather than relative percentages, but to allow comparisons with previous papers (like [Ruttle et al., 2021](https://doi.org/10.1038/s41598-021-81031-y) and [Ruttle et al., 2022](https://doi.org/10.1152/jn.00082.2022)) we also provide the group average rate of change as a percentage of asymptote. The statistics here are all done on the absolute degree change: which is the relative rate of change multiplied by the asymptote (which is roughly the degree change in the first trial, but informed by the full timecourse, so much less noisy).

For total adaptation, the two larger rotations behave similarly, with the rate of change decreasing for smaller rotations. The asymptotes for the two larger rotations seems similar as well.

The washout periods otoh show the same pattern for both regular reaches and no-cursor reaches. In the 2 largest rotations - if not the 3 largest rotations, there seems a significant portion of labile implicit adaptation. Starting with the first aligned trial in the washout phase, the 3 larger rotations appear indistinguishable from each other. The 15 degree rotation shows smaller reach deviations in both types of trials, which signifies a qualitative difference between this small rotation and the 3 larger ones.

When looking at the relationship between explicit (re-aiming) and implicit (no-cursors), there is no linear relationship, although both seem to get a bit larger with increasing rotation size. Additionally, the distribution of our measures of implicit shows the same peak for the 3 larger conditions, and a smaller one for the smallest rotation; the same pattern as in the no-cursor time-courses and in the reach and no-cursor washouts. For explicit re-aiming strategies, we see uni-modal distributions around zero for the two smaller rotations, and bi-modal distributions for the two larger rotations, with 1 peak around zero and another peak at around 20 degrees. Maybe there is even a 3rd peak at 45 degrees for the largest rotation.

## Statistics

### Exponential fits

Here are the Bayesian F-tests on rate of change and asymptote of reach training:

```{r}
expFitBayesianFtest(exp=1,type='reaches')
```

Since both show effects, we look at between-group comparisons for successive rotation sizes:

```{r}
expFitGroupBayesianTtest(exp=1, type='reaches', mode='learning', timecoursemode='absolute')
```

THIS DOES NOT EXPLAIN THE EFFECT OF ROTATION SIZE ON LAMBDA, FOUND ABOVE!!!

Here are the Bayesian F-tests on rate of change and asymptote of no-cursors:

```{r}
expFitBayesianFtest(exp=1, type='nocursors')
```

Again, we look at between-group comparisons for successive rotation sizes, and since the BF for lambda indicates pretty good support _for_ the null hypothesis, we only do this for the asymptote / N0:

```{r}
expFitGroupBayesianTtest(exp=1, type='nocursors', mode='learning', lambda=FALSE)
```

So for the two larger rotations, the asymptote of no-cursors is equivalent, but between 15 and 30 degrees and 30 and 45 degrees, the asymptote does increase.

Here are the Bayesian F-tests on rate of change and asymptote of reach washout:

```{r}
expFitBayesianFtest(exp=1,type='reaches',mode='washout')
```

We look at between-group comparisons for successive rotation sizes, but now also for lambda / RofC:

```{r}
expFitGroupBayesianTtest(exp=1, type='reaches', mode='washout')
```
Every comparison indicates some kind of difference.

Here are the Bayesian F-tests on rate of change and asymptote of no-cursor washout:

```{r}
expFitBayesianFtest(exp=1,type='nocursors',mode='washout')
```

No-cursors are not different between the groups in either parameter fit to the washout data.

In the figure it really does look like the 15 deg group has a lower N0 than the other groups. More or less like in reach training. So, despite a lack of an effect on the starting value (N0 is not the asymptote in this case) in washouts for no-cursors, we compare the starting point (asymptote / N0) between the 15 deg group and the three other groups:

```{r}
expFitGroupBayesianTtest(exp=1, type='nocursors', mode='washout', lambda=FALSE)
```

There might be some kind of effect comparing 15 to 45 degrees, but it's not very convincing.

### Aiming

We have complemented the continuous measures of implicit reach aftereffects with 8 re-aiming trials after 56 trials of training. Each set of 4 training and 4 no-cursor trials is preceded by a single re-aiming task, where people orient an arrow to indicate where they would move their hand in order to get the cursor on the target. The re-aiming trials are timed such that aiming does not affect the normal adaptation processes, as we have seen before ('t Hart et al., 2023, [bioRxiv](https://www.biorxiv.org/content/10.1101/2022.06.07.495044v3)). We expect little explicit strategy in the 15 and 30 degree conditions, and will see how this develops in larger rotations. Finally, we will also test if implicit adaptation can be predicted from explicit adaptation.

For those interested; in the last experiment we compare a continuous aiming condition with a control condition.

First we test if there is any effect of condition / rotation size on the magnitude of re-aiming responses:

```{r}
aimingBayesianFtest(exp=1)
```

There is, so that we now first compare the re-aiming responses to 0 for each condition, and then compare them between successive rotations.

Here are the comparisons with 0:

```{r}
aimingZero()
```

The evidence goes toward some small amount of re-aiming in the 15 degree condition, although this is largely driven by 2 participants and it does not reach threshold (BF=3). There is some re-aiming happening in the 30 degree condition (3 degrees on average). In Fig 2G we can see that the distribution of re-aiming responses is still close to zero, but it is about 3 degrees. In the other two conditions, it is much more clear that almost all participants engage in some amount of re-aiming. This can both be seen in Fig 2G and is shown by the statistics above.

Now we compare aiming between successive rotations.

```{r}
aimingGroupTtest(exp=1)
```

Despite there being pretty good evidence for re-aiming strategies in the 30 degree group and not in the 15 degree group, re-aiming is not very different between the two groups. We do see the expected difference between the 30 and 45 degree group, but it is only approaching significance when comparing the 45 and 60 degree group. Perhaps this can be explained by the larger spread with larger rotations.

### Linear prediction of measures of implicit from measures of explicit adaptation

Here we test explicit adaptation as a predictor of implicit adaptation.

```{r}
testGroupLinearAdditivity(exp=1)
```

There is a significant linear relationship in the 60 degree group only, but this is far from indicating additivity (slope -1). In the groups with lower rotations, the relationship is not even significant.

## Conclusions

The interleaved trial method works here as well. The explicit re-aiming trials also behave more or less as expected. Here is an overview of findings.

1. Amounts of initial change do not increases between pairs of successive rotation sizes. There is an overall effect of rotation size on initial change in reach training though... not sure what this means: more analyses? There is no effect on initial change in no-cursor reach deviations.

2. Reach training asymptotes keep increasing with rotation size. In no-cursor reach deviations the asymptote increases with rotation size, except between 45 and 60 degrees.

3. In washout, the overall tests indicate effects of rotation size on both starting point and initial change. Both starting points and initial change are different between the 15 degree group and all 3 other groups.

4. There is some amount of re-aiming in all groups, except for the lowest rotation of 15 degrees (and in the 30 degree condition it is very low: ~3 degrees). Re-aiming strategies are equivalent between 15 and 30 degrees, and between 45 and 60 degrees. The latter perhaps due to large variability and multi-modal distributions.

5. The amount of explicit strategies is barely informative about the amount of implicit adaptation, but only in the 60 degree group.

To test how different kinds of feedback impact the time course of implicit adaptation - in particular in the presence of explicit adaptation as well, we will continue using the 45 degree rotation. It's an easier rotation to learn, but there is still sufficient explicit adaptation to modulate it either way. We will skip the washout phases however, as they don't seem to add much to other measures. This also leaves time for additional measures.

# Experiment 2: feedback types

Here we test the timecourse of implicit adaptation, with two different kinds of feedback. In the rotation size experiment, the cursor was visible continuously, and was rotated right from the start of each trial. Here, in one condition, we keep the cursor aligned the first 50% of the reach, and introduce the rotation only after 50% of the home-target distance is exceeded. At that point, the cursor jumps from aligned to 45 degrees rotated: the _"cursor-jump"_ condition (cf. [Gastrock et al., 2020](https://doi.org/10.1038/s41598-020-76940-3)). Then, we also introduce a condition where the cursor is not shown during the reach, or during the return. It is only shown at 1 point: the first point that is at or beyond the distance of the target. The feedback is shown is for 750 ms. (During the return to the start position, different feedback is provided to allow returning to the start position without given position feedback: a circle, centred on the home position, with radius equal to the distance between where the cursor would be and the home position.) We call this the _"terminal"_ condition.

Both are supposed to increase explicit learning, and should or could reduce implicit learning. We've observed both for the _cursor-jump_ condition ([Gastrock et al., 2020](https://doi.org/10.1038/s41598-020-76940-3)). While this has been shown before, but the time-course of implicit learning has not been characterized yet (but see [Ruttle et al., 2022](https://doi.org/10.1152/jn.00082.2022) for a first look at the effect of terminal feedback on the timecourse of implicit adaptation). Apart from these 2 new conditions, we collect more participants doing a 45 degree rotation (albeit without the washout) and we combine these participants with the existing 45 degree as a reference condition for all new experiments, and we call this the _"control"_ condition.

Here is a table about the sample of participants:

```{r}
knitr::kable(demographicsTable(exp=2))
```

Here is the data:

```{r fig.width=6, fig.height=7.5}
expBehaviorFig(exp=2, target='inline', timecoursemode = 'absolute')
```

## Table

The table below is similar to that for experiment 1, except that there are no washout phases.

```{r}
knitr::kable(expTable(exp=2))
```

## Impressions left by figure and table

Overall adaptation seems equal for the three groups. The control group does appear to have larger implicit aftereffects. The timecourses don't show much of a difference between the groups for overall adaptation. However, at first glance, the implicit, no-cursor timecourses do look qualitatively different. Implicit adaptation seems slower for cursor-jump and more so for terminal feedback, and perhaps lower.

The distribution of explicit (re-aiming) strategies, is no longer clearly bi-modal with 1 peak at 0 explicit strategies for the two new conditions. It would seem that _all_ participants developed some kind of strategy in these conditions. That means they indeed evoked explicit adaptation to a much larger degree than the control condition.

The distribution of implicit (no-cursors) seems to have changed in the control group as well, because of the addition of extra participants. Where before there was only the impression of a long-tailed distribution, now it seems that there are two separate peaks. The two conditions making up the control group are exactly identical however, so we have no reason to interpret this as anything but natural variance (luckily, we have a reasonably large sample). As also seen in the timecourse, implicit adaptation was larger in the control group than in the other groups. The asymptotic levels of implicit adaptation are suppressed in the two conditions with larger explicit adaptation, slightly. Finally, there appears to be no clear relationship between these measures of implicit and explicit components of adaptation.

## Statistics

Here are the Bayesian F-tests on rate of change and asymptote of reach training:

```{r}
expFitBayesianFtest(exp=2,type='reaches')
```

We're not doing any follow-ups because there are no effects, and that's what it looks like in the figure as well.

Here are the Bayesian F-tests on rate of change and asymptote of no-cursors:

```{r}
expFitBayesianFtest(exp=2, type='nocursors')
```

It _looks_ like the implicit time courses develop at different speeds in the figure, but there really is no effect...

### Aiming

Testing for an effect of condition / group on re-aiming:

```{r}
aimingBayesianFtest(exp=2)
```

Seems there is an effect on explicit strategies, so now we compare the control group to the others:

```{r}
aimingGroupTtest(exp=2)
```

Both groups are different from control.

### Linear prediction of implicit from explicit

Here we test explicit adaptation as a predictor of implicit adaptation.

```{r}
testGroupLinearAdditivity(exp=2)
```

None of the relations are significant, and confidence intervals of the slopes include 0 but not -1.

## Conclusions

1. The two new conditions: terminal feedback and cursor-jump, did have the expected effect of increased explicit strategies.

2. This did not go hand-in-hand with any changes in implicit adaptation: both the asymptotic levels and the initial changes in implicit adaptation were equivalent in all conditions.

3. There was no relationship between levels of implicit adaptation and levels of explicit adaptation in any of the three conditions.

In this experiment we can see that some manipulations (types of feedback) may work very well to increase explicit strategies, but this is not necessarily accompanied by any changes in the level or speed of implicit adaptation. This shows that explicit and implicit adaptation can be independent processes.

# Experiment 3: delays with terminal feedback

The terminal feedback in the previous experiment should lead to "explicit-only" adaptation, if there is a delay after reach completion and before the feedback is shown. We test this in a variant on the previous "terminal" condition where the feedback is presented after a delay, the _"delay -> feedback"_ condition. This changes both the overall duration of the experiment, which could also change learning. So we controlled for this with a condition where the terminal feedback is shown first, and then there is a delay of the same duration. We call this the _"feedback -> delay"_ condition. In these two tasks, the delays (with no feedback on the screen at all) are 1200 ms and the terminal feedback is shown for 600 ms. In both cases, the participant is supposed to _hold_ at the endpoint of their reach, so there is a separate hold time of 1800 ms. If the hold is broken (a movement of more than **XXX** away from the end position) then **WHAT HAPPENS?**.

Here is a table about the sample of participants:

```{r}
knitr::kable(demographicsTable(exp=3))
```

The data is shown here:


```{r fig.width=6, fig.height=7.5}
expBehaviorFig(exp=3, target='inline', timecoursemode = 'absolute')
```

## Table

```{r}
knitr::kable(expTable(exp=3))
```

## First observations

In the two new conditions, overall adaptation is comparable in both speed and asymptote with the previous terminal condition, as well as the control condition. The speed of implicit adaptation seems to be in between that of the previous terminal condition and the control condition. In both conditions with delay there is a wide range of explicit re-aiming strategies, including 0 strategy this time. On average they might actually be lower in these conditions, rather than higher. Distributions of implicit adaptation are comparable in all 3 terminal feedback condition: the presence of delays, or the order of feedback and delay do not seem to affect the asymptotic levels of implicit adaptation. It might no longer be surprising there was no relationship between explicit and implicit measures of adaptation.

## Statistics

Here are the Bayesian F-tests on rate of change and asymptote of reach training:

```{r}
expFitBayesianFtest(exp=3,type='reaches')
```

These Bayes Factors indicate both the rates of change and the asymptotes in overall reach training are equal between all groups. We won't do any follow-ups.

Here are the Bayesian F-tests on rate of change and asymptote of no-cursors:

```{r}
expFitBayesianFtest(exp=3, type='nocursors')
```

This also does not indicate any differences.

### Aiming

We see if there is any effect on aiming responses:

```{r}
aimingBayesianFtest(exp=3)
```

There is an effect. Slightly surprising? Let's see where the differences are.

```{r}
aimingGroupTtest(exp=3)
```

It appears that in the terminal feedback without any kind of delay, the re-aiming responses are larger than in all other groups. That is: added delays do not seem to make learning more explicit in this data set, but _less_ explicit.

### Linear correlation between implicit and explicit adaptation

Here we test explicit adaptation as a predictor of implicit adaptation.

```{r}
testGroupLinearAdditivity(exp=3)
```

The two untested groups here (the two with delays) again show no linear relationship between implicit and explicit adaptation.

## Conclusion

1. Terminal feedback did increase explicit adaptation. Counter to previous papers, adding delays before (or after) the terminal feedback decreased explicit re-aiming.

2. There were no effects on overall learning or implicit adaptation. 

3. Implicit and explicit adaptation varied in both new conditions, but independently.

# Experiment 4: continuous aiming

So far, we have only used 8 re-aiming trials when adaptation was relatively close to saturation. In this experiment, we want to see if adding a re-aiming trial before each and every training trial affects explicit adaptation, and perhaps implicit adaptation as well. So we added a condition where every reach training trial was preceded by a re-aiming assessment (arrow orienting). We call this the _"aiming"_ condition. This group also did a no-cursor reach after every training trial.

Here is a table about the sample of participants:

```{r}
knitr::kable(demographicsTable(exp=4))
```

Here is the data:

```{r fig.width=6, fig.height=7.5}
expBehaviorFig(exp=4, target='inline', timecoursemode = 'absolute')
```
## Table

```{r}
knitr::kable(expTable(exp=4))
```

## First observations

Magenta is aiming (should be added to the legend somewhere...). The asymptote for the continuous aiming group looks a bit higher, at least at the start. We can see this in the exponential timecourse plots (fit on only the data up to where the first aiming is seen in most conditions: the 57th trial, but of course there has been a lot of aiming trials in the new condition at that point). At the end of the 100 trials of adaptation, levels seem more similar again, but it might just be that having to think about strategies in terms of directions of hand movements, gives away information to participants on the nature of the perturbation, and perhaps how to deal with it - acting as a partial instruction on how to counter the rotation. The no-cursor timecourse is similar in the continuous aiming group and the control group. The timecourse of explicit adaptation rises a bit faster though. The level of implicit adaptation in the new continuous adaptation group seems uni-modal, aligning with the first component in the distribution of implicit adaptation in the control group, so that it's overall slightly smaller. The distribution of explicit adaptation also looks uni-modal, but the average is twice as large as in the control group. That is: for 45 degree rotations, the introduction of continuous aiming does not change behavior as much as with 30 degree rotations ('t Hart et al., under review).

## Statistics

Here are the Bayesian F-tests on rate of change and asymptote of reach training:

```{r}
expFitBayesianFtest(exp=4,type='reaches')
```

Here are the Bayesian F-tests on rate of change and asymptote of no-cursors:

```{r}
expFitBayesianFtest(exp=4, type='nocursors')
```

Adding continuous aiming does not seems to affect the speed or extent of overall learning or implicit adaptation.

### Aiming

Let's see if there is a difference in aiming between the continuous aiming group and the control group.

```{r}
aimingGroupTtest(exp=4)
```

Looking at the data in the figure, the re-aiming responses in the continuous aiming group turned out higher than those in the control group.

### Implicit-explicit correlation

Here we test explicit adaptation as a predictor of implicit adaptation.

```{r}
testGroupLinearAdditivity(exp=4)
```

Also in the aiming group, there seems to be no relationship between measures of implicit and measures of explicit adaptation.

## Conclusion

1. Adding continuous aiming increases explicit strategies. It does not increase overall learning, or decrease implicit adaptation.

2. Continuously asking for re-aiming responses does not lead to a relationship between implicit and explicit adaptation, where there otherwise would be none.

# Export manuscript figures

```{r eval=F}
targets <- c('pdf') # svg, png, tiff
for (exp in c(1:4)) {
  for (target in targets) {
    expBehaviorFig(exp=exp, target=target)
  }
}
```

